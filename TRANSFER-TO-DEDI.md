# Transfer Mythofy Mail to Dedicated Server 🚀

## Quick Transfer Guide

### Step 1: Package the Project

On your local machine:
```bash
cd "c:\Users\jonah\Desktop\VSCODE\Mythofy\SOGO custom theme"
tar -czf mythofy-mail.tar.gz mythofy-mail/
```

### Step 2: Transfer to Dedi

**Option A: Using SCP**
```bash
scp mythofy-mail.tar.gz user@your-dedi-ip:/opt/
```

**Option B: Using Git (Recommended)**
```bash
# On local machine - create repo and push
cd mythofy-mail
git init
git add .
git commit -m "Initial Mythofy Mail setup"
git remote add origin <your-git-repo>
git push -u origin main

# On dedi server - clone
cd /opt
git clone <your-git-repo> mythofy-mail
```

**Option C: Using rsync**
```bash
rsync -avz mythofy-mail/ user@your-dedi-ip:/opt/mythofy-mail/
```

### Step 3: Setup on Dedi

SSH into your dedicated server:
```bash
ssh user@your-dedi-ip
cd /opt/mythofy-mail
```

**One-command setup:**
```bash
chmod +x setup.sh deploy.sh && ./setup.sh && nano .env && ./deploy.sh
```

Or step-by-step:
```bash
# 1. Make scripts executable
chmod +x setup.sh deploy.sh

# 2. Run setup
./setup.sh

# 3. Configure environment
nano .env
# Add your MAILCOW_API_KEY

# 4. Deploy
./deploy.sh
```

---

## For Claude Code on Dedi

### Initial Setup
```bash
cd /opt/mythofy-mail

# Install dependencies for development
cd frontend && npm install
cd ../backend && cargo build
cd ..
```

### Development Commands

**Using Makefile (easiest):**
```bash
make dev          # Start dev servers
make logs         # View logs
make restart      # Restart services
make deploy       # Deploy changes
make status       # Check status
```

**Manual:**
```bash
# Frontend development
cd frontend
npm run dev       # Runs on :3000

# Backend development
cd backend
cargo run         # Runs on :8080

# Docker deployment
./deploy.sh
```

### Make Changes with Claude Code

1. **Edit files** in `/opt/mythofy-mail`
2. **Test changes:**
   ```bash
   make deploy
   make logs
   ```
3. **Commit:**
   ```bash
   git add .
   git commit -m "Feature: ..."
   git push
   ```

---

## Folder Structure on Dedi

```
/opt/mythofy-mail/
├── frontend/              # Next.js - Claude can edit
├── backend/               # Rust - Claude can edit
├── nginx/                 # Proxy config
├── docker-compose.yml     # Container setup
├── .env                   # Your secrets
├── setup.sh              # Initial setup
├── deploy.sh             # Deployment
├── Makefile              # Quick commands
└── docs/                 # All documentation
```

---

## Environment Variables

On your dedi, edit `.env`:
```bash
nano .env
```

Required:
```env
MAILCOW_API_KEY=<get-from-mailcow-admin>
JWT_SECRET=<auto-generated-by-setup>
MAILCOW_API_URL=https://mail.mythofy.net
IMAP_HOST=mail.mythofy.net
SMTP_HOST=mail.mythofy.net
```

---

## Quick Commands Reference

```bash
# Setup (once)
make setup

# Deploy
make deploy

# Logs
make logs
make logs-backend
make logs-frontend

# Restart
make restart

# Status
make status
make health

# Clean & rebuild
make clean
make deploy

# Backup
make backup

# Update from git
make update
```

---

## Ports Used

- **3000** - Frontend (Next.js)
- **8080** - Backend (Rust API)
- **80** - Nginx (HTTP)
- **443** - Nginx (HTTPS)
- **3306** - MySQL (internal)
- **6379** - Redis (internal)

Make sure these are open in your firewall:
```bash
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

---

## SSL/TLS Setup (Production)

After transfer, set up SSL:
```bash
# Install certbot
sudo apt install certbot

# Get certificate
sudo certbot certonly --standalone -d mail.mythofy.net

# Copy to nginx
sudo cp /etc/letsencrypt/live/mail.mythofy.net/fullchain.pem nginx/ssl/cert.pem
sudo cp /etc/letsencrypt/live/mail.mythofy.net/privkey.pem nginx/ssl/key.pem
sudo chmod 644 nginx/ssl/*.pem

# Restart nginx
make restart nginx
```

---

## Verify Transfer

After setup on dedi:
```bash
# Check services
make status

# Check health
curl http://localhost:8080/api/health

# View logs
make logs

# Access frontend
curl http://localhost:3000
```

Open browser to: `http://your-dedi-ip:3000`

---

## Troubleshooting Transfer

**Permission denied?**
```bash
sudo chown -R $USER:$USER /opt/mythofy-mail
chmod +x setup.sh deploy.sh
```

**Docker not installed?**
```bash
./setup.sh  # Installs Docker automatically
```

**Services won't start?**
```bash
make logs
# Check for missing env vars
```

**Port conflicts?**
```bash
netstat -tulpn | grep -E '3000|8080|80'
# Kill conflicting processes or change ports in docker-compose.yml
```

---

## Next Steps After Transfer

1. ✅ Transfer complete
2. 📝 Configure `.env` with Mailcow API key
3. 🚀 Deploy: `make deploy`
4. 🔐 Setup SSL (see above)
5. 🌐 Point DNS to server
6. 🎨 Start customizing with Claude Code!

---

## Documentation

All docs are in the project:
- [INDEX.md](INDEX.md) - Documentation index
- [QUICKSTART.md](QUICKSTART.md) - 5-min setup
- [DEPLOYMENT.md](DEPLOYMENT.md) - Full deployment guide
- [README.md](README.md) - Project overview

---

**You're ready to develop on your dedi!** 🎉
